<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
 <div class="row">
    <div class="col">
          <div class="box">
             <h2>YAY</h2>
         </div>
    </div>
    <div class="col">
        <div class="box">
            <div id="form-page">
          <div id="text">
            <h2>Book A Call</h2>
            <p>To book a call with us fill the following form.</p>
         </div>
        <form id="form">
            <label for="name">Name
            <input type="text" value="" id="name" placeholder="name" class="input"/>
            </label>
           <br/>
          <label for="email">Email
          <input type="email" value="" id="email" placeholder="johnDoe@domain" class="input"/>
           </label>
          <br/>
           <label for="number">Phone-Number
            <input type="text" value="" id="number" placeholder="xxxxxxxx" class="input"/>
           </label>
           <br/>
            <label for="time">Time Of Call
            <div id="set-time">
              <input type="Date" value="" id="date" class="input"/>
               <input type="time" value="" id="time" class="input"/>
             </div>
             </label>
           <br/>
           <br/>
        </form>
        <button id="button" onclick="postUser()">Get a Call</button>
           </div>
       </div>
    </div>
    <div class="col">
       <div class="box">
          <a href="url">Home</a>
          <a href="url">About</a>
       </div>
    </div>
    </div>
    <div class="row">
        <h4 id="appoint-ments">Appointments</h4>
        <ol id="booking-list">
            
        </ol>
    </div>
</div>
   
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>

<script>
    let details=document.getElementsByClassName("input")
    let list=document.getElementById("booking-list")
    let btn=document.getElementById("button")
// show the appontments when the page loads
    axios.get("https://crudcrud.com/api/313bb13c80174f69afd35ea8264b6f3a/appointmentApp")
    .then(data=>showOutput(data.data)).catch(e=>console.log(e))
    // posts the input data in backend server
function postUser(){
    let detail={}
    Array.from(details).forEach(i=>detail={...detail, [i.id]:i.value})
    axios.post("https://crudcrud.com/api/313bb13c80174f69afd35ea8264b6f3a/appointmentApp",detail).then(data=>showOutput([data.data])).catch(e=>console.log(e))

}
function showOutput(users){
    users.forEach(obj=>{
        let li=document.createElement("li")
        li.classList.add("user")
        let div=document.createElement("div")
        div.classList.add("details")
        div.innerHTML=`<p>${obj.name}</p><p>Email- ${obj.email}</p><p>Phone-Number-${obj.number}</p>
        <p>Date of appointment-${obj.date} at ${obj.time}</p>`
       li.appendChild(div)
        list.appendChild(li)
        let deleteBtn=document.createElement("button")
        deleteBtn.textContent="Delete"
        deleteBtn.addEventListener("click",()=>{
            axios.delete(`https://crudcrud.com/api/313bb13c80174f69afd35ea8264b6f3a/appointmentApp/${obj._id}`).then(data=>{
              list.innerHTML=""
                     axios.get("https://crudcrud.com/api/313bb13c80174f69afd35ea8264b6f3a/appointmentApp").
                     then(newData=>showOutput(newData.data)).catch(e=>console.log(e))
            })
            })
         li.appendChild(deleteBtn)

        let editBtn=document.createElement("button")
        editBtn.textContent="Edit"
        editBtn.addEventListener("click",()=>{
        axios.get(`https://crudcrud.com/api/313bb13c80174f69afd35ea8264b6f3a/appointmentApp/${obj._id}`)
        .then(data=>{Object.keys(data.data).forEach(e=>{
                                  if(e!="_id"){
                               let inputElement=document.getElementById(`${e}`)
                                      inputElement.value=data.data[e]} })
                list.innerHTML=""
                axios.get('https://crudcrud.com/api/313bb13c80174f69afd35ea8264b6f3a/appointmentApp').then(data=>{
                    let newData=data.data.filter(e=>e._id!=obj._id)
                    showOutput(newData)
                }).catch(e=>console.log(e))
      let formpage=document.getElementById("form-page")
      let saveBtn=document.createElement("button")
      saveBtn.textContent="save"
      formpage.appendChild(saveBtn)
      saveBtn.addEventListener("click",()=>{
        let putObj={}
       Array.from(details).forEach(e=>putObj={...putObj,[e.id]:e.value})
      axios.put(`https://crudcrud.com/api/313bb13c80174f69afd35ea8264b6f3a/appointmentApp/${obj._id}`,putObj).then(d=>{
        list.innerHTML=""
      axios.get('https://crudcrud.com/api/313bb13c80174f69afd35ea8264b6f3a/appointmentApp').then(data=>showOutput(data.data))
      })
      formpage.removeChild(saveBtn)
      })
    })
  })
        //  li.appendChild(editBtn)
    
})
}
      
      
</script>
</html>

